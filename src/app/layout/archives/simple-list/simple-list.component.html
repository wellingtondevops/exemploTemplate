<div [@routerTransition]>
    <div *ngIf="loading">
        <ngx-loading [show]="loading" [config]="{
            backdropBorderRadius: '3px',
            fullScreenBackdrop: true,
            primaryColour: '#222',
            secondaryColour: '#222',
            tertiaryColour: '#222'
        }"></ngx-loading>
    </div>
    <div class="card  mb-3">
        <div class="card-header">
            <div class="row">
                <div class="col-lg-11">
                    <h2>Pesquisa Simples de Arquivos</h2>
                </div>
                <div class="col-lg-1 text-right">
                    <i class="mdi mdi-help-circle mdi-24px" style="color:#2869D9;" (click)="help()"></i>
                </div>
            </div>
        </div>
        <div class="card-body">
            <form [formGroup]="searchForm" role="FormGroup" class="form">
                <div id="step2">
                    <div class="row">
                        <div class="form-group col-lg-6 col-sm-12">
                            <label for="typeahead-focus">Empresa</label>
                            <input id="typeahead-focus" autoFocus="true" type="text" class="form-control"
                                formControlName="company" (selectItem)="selectedCompany($event)"
                                placeholder="Nome da Empresa" [resultTemplate]="rtCompany" [inputFormatter]="formatter"
                                [ngbTypeahead]="searchCompany" style="width: 100%" #instanceCompany="ngbTypeahead"
                                (focus)="focusCompany$.next($any($event).target.value)"
                                (click)="clickCompany$.next($any($event).target.value)" />
                        </div>
                        <div class="form-group col-lg-6 col-sm-12">
                            <label for="typeahead-focus">Departamento</label>
                            <input id="typeahead-focus" autoFocus="true" type="text" class="form-control"
                                placeholder="Nome do Departamento" formControlName="departament"
                                [resultTemplate]="rtDepartament" [inputFormatter]="formatter"
                                [ngbTypeahead]="searchDepartament" style="width: 100%"
                                #instanceDepartament="ngbTypeahead"
                                (focus)="focusDepartament$.next($any($event).target.value)"
                                (click)="clickDepartament$.next($any($event).target.value)" />
                        </div>
                    </div>
                    <div class="row" id="step3">
                        <div class="form-group col-lg-4 col-sm-12">
                            <label for="typeahead-scrollable">Documento</label>
                            <input id="typeahead-scrollable" autoFocus="true" type="text" class="form-control"
                                placeholder="Nome do Documento" formControlName="doct" [resultTemplate]="rtDocument"
                                [inputFormatter]="formatter" [ngbTypeahead]="searchDocument" style="width: 100%"
                                #instanceDocument="ngbTypeahead"
                                (focus)="focusDocument$.next($any($event).target.value)"
                                (click)="clickDocument$.next($any($event).target.value)" />
                        </div>
                        <div class="form-group col-lg-4 col-sm-12">
                            <label for="search_archive">Índice</label>
                            <input id="search_archive" class="form-control col-12" placeholder="Informe o Índice"
                                formControlName="search" />
                        </div>
                        <div class="form-group col-lg-2 col-sm-12">
                            <label for="initDate">Data Inicial</label>
                            <input id="initDate" type="date" class="form-control col-12" [(ngModel)]="dateSent"
                                (input)="changeDate()" formControlName="initDate" formControlName="initDate" />
                        </div>
                        <div class="form-group col-lg-2 col-sm-12">
                            <label for="endDate">Data Final</label>
                            <input id="endDate" type="date" class="form-control col-12" formControlName="endDate"
                                [disabled]="!dateSent" [min]="dateSent" />
                        </div>
                    </div>
                </div>
                <div class="row col-12 text-center" id="step4">
                    <div class="form-group ">
                        <button type="submit" class="btn btn-primary" [disabled]="company.invalid" (click)="getArchive()">
                            <i class="fa fa-search"></i>
                        </button>
                        <button type="button" style="margin-left: 5px;" [disabled]="company.invalid"
                            class="btn dark-btn" (click)="clear()">
                            Limpar Campos
                        </button>
                        <button [disabled]="company.invalid || page.totalElements == 0" type="button"
                            style="margin-left: 5px;" class="btn btn-success" (click)="exportArchives()"
                            (click)="open(content)" *ngIf="!noExternal">
                            <i class="fa fa-file-excel-o" aria-hidden="true"></i>&emsp;Exportar Pesquisa
                        </button>
                    </div>
                </div>

                <ng-template #content let-c="close" let-d="dismiss">
                    <div class="modal-header">
                        <h4 class="modal-title" id="modal-basic-title">Solicitação enviada!</h4>
                    </div>
                    <div class="modal-body">
                        <p>Sua solicitação de exportação foi realizada com sucesso, este processo
                            e automatizado e dependendo da quantidade de itens pode demorar um pouco.</p>
                        <strong>Mas não se preocupe, assim que o processo de exportação for finalizado avisaremos via
                            notificação e e-mail.</strong>
                        <br />
                        <small>Não é necessario, aguardar na pagina.</small>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-outline-success" (click)="c()">Confirmar</button>
                    </div>
                </ng-template>

                <ng-template #rtCompany let-r="result" let-t="company" class="custom-typeahead">
                    <ngb-highlight [result]="r.name" [term]="t"></ngb-highlight>
                </ng-template>
                <ng-template #rtDepartament let-r="result" let-t="departament" class="custom-typeahead">
                    <ngb-highlight [result]="r.name" [term]="t"></ngb-highlight>
                </ng-template>
                <ng-template #rtStorehouse let-r="result" let-t="storehouse" class="custom-typeahead">
                    <ngb-highlight [result]="r.name" [term]="t"></ngb-highlight>
                </ng-template>
                <ng-template #rtDocument let-r="result" let-t="doct" class="custom-typeahead">
                    <ngb-highlight [result]="r.name" [term]="t"></ngb-highlight>
                </ng-template>
            </form>
        </div>
    </div>
    <div id="step5">
        <ngx-datatable #myTable class="bootstrap" [rows]="archives" [columnMode]="ColumnMode.force" [scrollbarH]="true"
            [headerHeight]="50" [footerHeight]="50" rowHeight="auto" [externalPaging]="true"
            [count]="page.totalElements" [offset]="page.pageNumber" [limit]="10" (page)='setPage($event)'
            (activate)="showView($event)">

            <ngx-datatable-column name="Empresa" prop="company.name" [width]="250"></ngx-datatable-column>

            <ngx-datatable-column name="Departamento" prop="departament.name" [width]="290"></ngx-datatable-column>

            <ngx-datatable-column name="Documento" prop="doct.name" [width]="300"></ngx-datatable-column>

            <ngx-datatable-column name="Indexação" prop="index" [width]="300"></ngx-datatable-column>

            <ngx-datatable-column name="Anexo" prop="picture" [width]="60">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    <i *ngIf="value" class="fa fa-file-pdf-o" style="font-size:40px;color:rgb(190, 36, 36)"></i>
                </ng-template>
            </ngx-datatable-column>

            <ngx-datatable-column name="Páginas" prop="picture.page" [width]="65"></ngx-datatable-column>

            <ngx-datatable-column name="Criado em" prop="create" [width]="85">
                <ng-template let-value="value" ngx-datatable-cell-template>
                    {{ value | date: 'dd/MM/yyyy' }}
                </ng-template>
            </ngx-datatable-column>

        </ngx-datatable>
    </div>
</div>
