<div [@routerTransition]>
    <ngx-loading [show]="loading" [config]="{
            backdropBorderRadius: '3px',
            fullScreenBackdrop: true,
            primaryColour: '#222',
            secondaryColour: '#222',
            tertiaryColour: '#222'
        }">
    </ngx-loading>
    <div class="card bg-light">
        <div class="card-header">
            <div class="row">
                <div class="col-lg-11">
                    <h2>Arquivos</h2>
                </div>
                <div class="col-lg-1 text-right">
                    <i class="mdi mdi-help-circle mdi-24px" style="color:#2869D9;" (click)="help()"></i>
                </div>
            </div>
            <div class="row" id="step1">
                <div class="col-lg-1" *ngIf="!loading">
                    <app-button-back [redirectTo]="'archives'"></app-button-back>
                </div>
                <div class="col-lg-11">
                    <!-- [id]="archive._id" -->
                    <app-buttons-custom  (edit)="editArchive(archive._id)"
                        (delete)="open('focusFirst', archive._id)" [permissionEdit]="permissionEdit"
                        [permissionDelete]="permissionDelete" [isUser]="isUsers">
                    </app-buttons-custom>
                </div>
            </div>
        </div>
        <div class="card-body" style="padding-top: 5px;">
            <div class="row" *ngIf="!loading">
                <div class="col-4" id="step2">
                    <h5>DADOS DO VOLUME</h5>
                    <div class="card bg-light mb-12">
                        <div class="card-body" style="padding: 10px;">
                            <div>
                                <strong> EMPRESA: </strong> <br />
                                <label> {{ archive.company.name }} </label>
                            </div>
                            <div>
                                <strong> DEPARTAMENTO: </strong> <br />
                                <label> {{ archive.departament.name }} </label>
                            </div>
                            <div>
                                <strong> DOCUMENTO: </strong> <br />
                                <label> {{ archive.doct.name }} </label>
                            </div>
                            <div>
                                <strong> DEPÓSITO: </strong> <br />
                                <label> {{ archive.storehouse.name }} </label>
                            </div>
                            <div>
                                <strong> POSIÇÃO: </strong> <br />
                                <label> {{ archive.volume.location }} </label>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-4 mt-2">
                        <h5 style="margin: 0px;">ÍNDICES</h5>
                    </div>
                    <div class="card bg-light mb-12">
                        <div class="card-body">
                            <app-form-index [data]="archive" [isArchive]="true">
                            </app-form-index>
                        </div>
                    </div>
                </div>
                <div class="col-8 mb-2">
                    <form [formGroup]="requestForm">
                        <div class="card bg-light mb-1" id="step3">
                            <div class="card-body " style="padding: 5px;">
                                <div class="row">
                                    <div class="col-lg-12 text-center" *ngIf="pending === true">
                                        <button class="btn btn-primary text-center btn-outline-danger" (click)="FimRequest()">
                                            Finalizar
                                        </button>
                                    </div>
                                    <div class="col-lg-12" *ngIf="pending === false">
                                        <label for="" style="margin: 5px;">Correções: </label>
                                        <div class="pretty p-switch p-fill">
                                            <input class="form-check-input" type="radio" name="requestType" formControlName="requestType" value="CORRECAO_IMAGEM" id="requestType1"/>
                                            <div class="state" for="requestType1">
                                                <label>
                                                    Correção de Imagem
                                                </label>
                                            </div>
                                        </div>
                                        <div class="pretty p-switch p-fill">
                                            <input class="form-check-input" type="radio" name="requestType" formControlName="requestType" value="CORRECAO_INDICE" id="requestType2"/>
                                            <div class="state" for="requestType2">
                                                <label>
                                                    Correção de Indíce
                                                </label>
                                            </div>
                                        </div>
                                        <div class="pretty p-switch p-fill">
                                            <input class="form-check-input" type="radio" name="requestType" formControlName="requestType" value="EMPRESTIMO" id="requestType3"/>
                                            <div class="state" for="requestType3">
                                                <label>
                                                    Emprestimo
                                                </label>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="row mb-1"  *ngIf="pending == false">
                                    <div class="col-10">
                                        <div class="form-floating">
                                            <textarea class="form-control" placeholder="Observações" name="notes" formControlName="notes" id="notes"
                                                style="height: 80px; width: 650px;"></textarea>
                                            <label for="notes">Observações:</label>
                                        </div>
                                    </div>
                                    <div class="col-2 mt-5 text-right">
                                        <button (click)="sendRequest()" type="button" class="btn btn-sm btn-dark">Enviar</button>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </form>
                    <form [formGroup]="uploadFile" (ngSubmit)="submit()">
                        <div class="form-group" id="step4">
                            <app-form-upload formControlName="file" [archive]="file" (postFile)="postFile($event)"
                                [savedFile]="savedFile" (deleteFile)="open('focusFirst', file._id)">
                            </app-form-upload>
                        </div>
                    </form>
                    <app-modal-progress-right-bottom [progress]="uploadResponse" [error]="errorUpload">
                    </app-modal-progress-right-bottom>
                </div>
            </div>
            <br />

            <div class="row" *ngIf="!loading">
                <div class="col-4" >
                    <h5>TEMPORALIDADE</h5>

                    <!-- FASE CORRENTE -->
                    <div class="card bg-light md-12" id="step5">
                        <div class="card-body">
                            <strong>Corrente: </strong><br />
                            <label
                                *ngIf="startCurrentDate && archive.doct.currentControl === false && archive.startDateCurrent == undefined">
                                Fase Corrente não Controlada
                            </label>
                            <label *ngIf="archive && archive.startDateCurrent === undefined">
                                {{ archive.doct.dcurrentLabel }}
                            </label>
                            <label *ngIf="archive && archive.startDateCurrent != undefined">
                                Início:
                                {{ returnDate(archive.startDateCurrent) }}
                            </label>
                            <label *ngIf="archive && archive.finalDateCurrent === true">
                                Fim:
                                {{ returnDate(archive.finalDateCurrent) }}
                            </label>
                            <br />
                            <br />

                            <strong>Intermediária: </strong> <br />
                            <label *ngIf="archive && archive.startDateCurrent === undefined">
                                {{ archive.doct.dintermediateValue }} Anos
                            </label>
                            <label *ngIf="archive && archive.startDateIntermediate">
                                Início:
                                {{ returnDate(archive.startDateIntermediate) }}
                            </label>
                            <label *ngIf="archive && archive.finalDateIntermediate">
                                Fim:
                                {{ returnDate(archive.finalDateIntermediate) }}
                            </label>

                            <br />
                            <br />
                            <strong>Destinação Final: </strong><br />
                            <label *ngIf="archive && archive.finalFase">
                                {{ archive.finalFase }}
                            </label>
                            <label *ngIf="archive && archive.startDateCurrent === undefined">
                                {{ archive.doct.dfinal }}
                            </label>
                            <label *ngIf="archive && archive.finalDateIntermediate">
                                Início:
                                {{ returnDate(archive.finalDateIntermediate) }}
                            </label>
                            <br />

                            <hr>
                            <div class="dataBtn" *ngIf="startCurrentDate && archive.doct.currentControl === true">
                                <h6>Ajuste de Temporalidade </h6>
                                <input type="date" class="form-control" [(ngModel)]="inputStartCurrentDate" />
                                <button *ngIf="archive && archive.doct.currentControl === true"
                                    class="btn btn-danger btn-sm" (click)="setStartCurrentDate()"
                                    style="margin-top: 5px;">
                                    Final Corrente
                                </button>
                            </div>
                        </div>
                    </div>

                    <br />
                    <div class="row" *ngIf="!loading">
                        <div class="col-12" id="step6">
                            <div style="font-size: 12px">
                                {{ archive.sponsor.name }}<br />
                                {{ archive.sponsor.cnpj }}<br />
                                Autor: {{ archive.author.email }}<br />
                                Data da criação: {{ returnDateCreate(archive.create) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
