<div [@routerTransition]>
  <ngx-loading [show]="loading" [config]="{
      backdropBorderRadius: '3px',
      fullScreenBackdrop: true,
      primaryColour: '#222',
      secondaryColour: '#222',
      tertiaryColour: '#222'
  }"></ngx-loading>
  <app-page-header [heading]="'Arquivos'" [icon]="'fa-table'"></app-page-header>
  <ngb-accordion #acc="ngbAccordion" activeIds="ngb-panel-0">
    <ngb-panel>
      <ng-template ngbPanelTitle>
        <span> <i class="fa fa-filter" style="margin-right: 5px"></i> <b>Filtros</b></span>
      </ng-template>
      <ng-template ngbPanelContent>
        <form [formGroup]="searchForm" (ngSubmit)="getArchive()" role="FormGroup" class="form-inline">
          <div class="row col-12">
            <div class="form-group mb-2 col-3">
              <label for="typeahead-basic">Empresa</label>
              <input id="typeahead-basic" autoFocus="true" type="text" class="form-control" formControlName="company"
                [resultTemplate]="rtCompany" [inputFormatter]="formatter" [ngbTypeahead]="searchCompany"
                [ngClass]="{ 'is-invalid': !company.valid }" style="width: 100%" />
              <div *ngIf="company.invalid && (company.dirty || company.touched)" class="invalid-feedback">
                <div *ngIf="!company.valid">
                  Empresa é obrigatório.
                </div>
              </div>
            </div>
            <div class="form-group mb-2 col-3">
              <label for="typeahead-basic">Departamento</label>
              <input id="typeahead-basic" autoFocus="true" type="text" class="form-control"
                formControlName="departament" [resultTemplate]="rtDepartament" [inputFormatter]="formatter"
                [ngbTypeahead]="searchDepartament" style="width: 100%" />
            </div>
            <div class="form-group mb-2 col-2">
              <label for="search_archive">Localização</label>
              <input id="search_archive" class="form-control col-12" formControlName="location" />
            </div>
            <div class="form-group mb-2 col-1">
              <label for="status">Status</label>
              <select class="form-control col-12" id="status" formControlName="status" (change)="statusChange()">
                <option *ngFor="let item of statusList | enumToArray" [value]="item">
                  {{ item }}</option>
              </select>
            </div>
            <div class="form-group mb-2 col-3">
              <label for="typeahead-basic">Armazém</label>
              <input id="typeahead-basic" autoFocus="true" type="text" class="form-control" formControlName="storehouse"
                [resultTemplate]="rtStorehouse" [inputFormatter]="formatter" [ngbTypeahead]="searchStorehouse"
                style="width: 100%" />
            </div>
          </div>
          <div class="row col-12">
            <div class="form-group mb-2 col-3">
              <label for="typeahead-basic">Documento</label>
              <input id="typeahead-basic" autoFocus="true" type="text" class="form-control" formControlName="doct"
                [resultTemplate]="rtDocument" [inputFormatter]="formatter" [ngbTypeahead]="searchDocument"
                style="width: 100%" />
            </div>
            <div class="form-group mb-2 col-6">
              <label for="search_archive">Índice</label>
              <input id="search_archive" class="form-control col-12" formControlName="search" />
            </div>
            <div class="form-group mb-2 col-3" style="padding-right: 0;">
              <div class="row col-12" style="padding-right: 0;">
                <label for="initDate">Data Inicial</label>
                <input id="initDate" type="date" class="form-control col-12" formControlName="initDate"/>
              </div>

              <div class="row col-12" style="padding-right: 0;">
                <label for="endDate">Data Final</label>
                <input id="endDate" type="date" class="form-control col-12" formControlName="endDate" />
              </div>
            </div>
          </div>
          <div class="row col-12" style="justify-content: center; margin-top: 10px;">
            <div class="form-group mb-2">
              <button type="submit" class="btn btn-default">
                <i class="fa fa-search"></i>
              </button>
            </div>
          </div>

          <ng-template #rtCompany let-r="result" let-t="company" class="custom-typeahead">
            <ngb-highlight [result]="r.name" [term]="t"></ngb-highlight>
          </ng-template>
          <ng-template #rtDepartament let-r="result" let-t="departament" class="custom-typeahead">
            <ngb-highlight [result]="r.name" [term]="t"></ngb-highlight>
          </ng-template>
          <ng-template #rtStorehouse let-r="result" let-t="storehouse" class="custom-typeahead">
            <ngb-highlight [result]="r.name" [term]="t"></ngb-highlight>
          </ng-template>
          <ng-template #rtDocument let-r="result" let-t="doct" class="custom-typeahead">
            <ngb-highlight [result]="r.name" [term]="t"></ngb-highlight>
          </ng-template>
        </form>
      </ng-template>
    </ngb-panel>
  </ngb-accordion>
  <br />
  <ngx-datatable #myTable class="material" [rows]="archives" [columnMode]="'force'" [headerHeight]="50"
    [footerHeight]="50" [rowHeight]="'auto'" [externalPaging]="true" [count]="page.totalElements"
    [offset]="page.pageNumber" [limit]="10" (page)='setPage($event)' (activate)="showView($event)">
    <!-- Row Detail Template -->
    <ngx-datatable-row-detail [rowHeight]="'auto'" #myDetailRow (toggle)="onDetailToggle($event)">
      <ng-template let-row="row" let-expanded="expanded" ngx-datatable-row-detail-template>
        <div class="container" style="padding-bottom: 10px">
          <div class="row">
            <div class="col-2" style="padding-left:35px;">
              <div *ngFor="let desc of row.doct.label"><strong>{{desc.namefield}}: </strong></div>
            </div>
            <div class="col-4" style="padding-left:35px;">
              <div *ngFor="let tag of row.tag">{{tag}} </div>
            </div>
          </div>
        </div>
      </ng-template>
    </ngx-datatable-row-detail>
    <!-- Column Templates -->
    <ngx-datatable-column [width]="50" [resizeable]="false" [sortable]="false" [draggable]="false"
      [canAutoResize]="false">
      <ng-template let-row="row" let-expanded="expanded" ngx-datatable-cell-template>
        <a href="javascript:void(0)" [class.datatable-icon-right]="!expanded" [class.datatable-icon-down]="expanded"
          title="Expand/Collapse Row" (click)="toggleExpandRow(row)">
        </a>
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Localização" [width]="200" prop="volume.location"></ngx-datatable-column>
    <ngx-datatable-column name="Descrição" [width]="200" prop="volume.description"></ngx-datatable-column>
    <ngx-datatable-column name="Guarda" [width]="150" prop="volume.guardType">
      <ng-template let-value="value" ngx-datatable-cell-template>
        {{ guardType(value) }}
      </ng-template>
    </ngx-datatable-column>
    <ngx-datatable-column name="Armazém" [width]="200" prop="storehouse.name"></ngx-datatable-column>
    <ngx-datatable-column name="Empresa" [width]="300" prop="company.name"></ngx-datatable-column>
    <ngx-datatable-column name="Criado em" [width]="300" prop="create">
      <ng-template let-value="value" ngx-datatable-cell-template>
        {{ value | date: 'dd/MM/yyyy' }}
      </ng-template>
    </ngx-datatable-column>
  </ngx-datatable>
</div>