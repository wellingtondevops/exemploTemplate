<div [@routerTransition]>
    <ngx-loading
        [show]="loading"
        [config]="{
            backdropBorderRadius: '3px',
            fullScreenBackdrop: true,
            primaryColour: '#222',
            secondaryColour: '#222',
            tertiaryColour: '#222'
        }"
    ></ngx-loading>

    <app-page-header
        [heading]="'Controle de Lote'"
        [icon]="'fa-table'"
    ></app-page-header>

    <div class="container" style="margin-left: 0px">
        <div class="row">
            <div style="margin-bottom: 10px">
                <app-button-back [redirectTo]="'batches'"></app-button-back>
                <br />
            </div>
            <div class="col">
                <h5>Dados do Lote</h5>
                <div class="card" id="dados" *ngIf="batch">
                    <h5>Nr Lote - {{ batch.batchNr }}</h5>
                    <p style="font-size: 12px">
                        <b>EMPRESA</b>: {{ batch.company.name }}<br />
                        <b>DOCUMENTO</b>: {{ batch.doct.name }}<br/>
                        <b>QUANTIDADE DE ARQUIVOS:</b> {{page.totalElements}}
                    </p>
                    <p style="font-size: 12px" class="pull-left">
                        Criado em: {{ batch.dateCreated }}
                    </p>
                </div>
            </div>
            <div class="col">
                <h5 style="margin-bottom: 0px">Funcionalidades</h5>
                <div class="btns">
                    <div *ngIf="batch">
                        <button
                            (click)="toIndex()"
                            type="button"
                            [disabled]="batchImages && batchImages.length <= 0"
                            class="btn btn-xs btn-success"
                        >
                            Indexar Lote
                        </button>
                        <button
                            type="button"
                            [disabled]="batchImages && batchImages.length <= 0"
                            class="btn btn-xs btn-danger"
                            (click)="deleteBatch()"
                        >
                            Excluir Lote
                        </button>
                        <button
                            type="button"
                            [disabled]="batchImages && batchImages.length <= 0"
                            class="btn btn-xs btn-dark"
                        >
                            Excluir PDF
                        </button>
                    </div>
                </div>
            </div>
            <div class="col">
                <h5 style="margin-top: 1px; margin-bottom: 0px">
                    Importar Imagens
                </h5>
                <div class="import">
                    <form
                        class="form-control"
                        [formGroup]="myForm"
                        (ngSubmit)="submit()"
                    >
                        <div
                            class="form-group"
                            id="btn-import"
                            style="font-weight: bolder; margin-bottom: 2px"
                        >
                            <input
                                formControlName="file"
                                id="file"
                                type="file"
                                multiple
                                class="form-control"
                                (change)="onFileChange($event)"
                            />
                        </div>
                        <button
                            class="btn btn-xs btn-primary"
                            type="submit"
                            style="margin-top: 0"
                        >
                            Importar
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- <div class="col-lg-6 col-sm-12 col-xs-12">
                        <form action="" class="form-control" style="border:none;border-radius:none">
                            <div class="col">
                                <label for="">Thumbnail</label>
                                <div class="radio">
                                    <label>
                                        <input (click)="getBatchImages(null, 50)"
                                            [disabled]="batchImages && batchImages.length <= 0" type="radio"
                                            name="optionsRadios" id="optionsRadios1" value="option1" checked>
                                        auto
                                    </label>
                                </div>
                                <div class="radio">
                                    <label>
                                        <input (click)="getBatchImages(null, 2)"
                                            [disabled]="batchImages && batchImages.length <= 0" type="radio"
                                            name="optionsRadios" id="optionsRadios2" value="option2">
                                        2
                                    </label>
                                </div>
                            </div>
                            <div class="col">
                                <div class="radio">
                                    <label>
                                        <input (click)="getBatchImages(null, 10)"
                                            [disabled]="batchImages && batchImages.length <= 0" type="radio"
                                            name="optionsRadios" id="optionsRadios3" value="option3" disabled>
                                        10
                                    </label>
                                </div>
                                <div class="radio">
                                    <label>
                                        <input (click)="getBatchImages(null, 20)"
                                            [disabled]="batchImages && batchImages.length <= 0" type="radio"
                                            name="optionsRadios" id="optionsRadios3" value="option3" disabled>
                                        20
                                    </label>
                                </div>
                            </div>
                        </form>
                    </div> -->
    <div class="row"></div>
    <div class="col">
        <div class="gallery">
            <div
                style="margin: 15px; max-width: 150px; height: 195px"
                *ngFor="let image of batchImages"
            >
                <iframe
                    *ngIf="pipes.isPdf(image.url)"
                    src="https://storage.googleapis.com/archiobucket/ARCHIOFILES/PDFthumbnailMenor.png"
                    style="border: none !important"
                >
                </iframe>

                <img
                    *ngIf="!pipes.isPdf(image.url)"
                    [src]="image.url"
                    id="{{ image._id }}"
                    class="img-thumbnail rounded"
                    (click)="selectedImg($event)"
                    [alt]="image.name"
                    style="vertical-align: 0"
                />
                <p style="font-size: 10px">{{ image.name }}</p>
            </div>
        </div>
        <br />
        <div style="display: flex; justify-content: center">
            <ngb-pagination
                (pageChange)="getBatchImages($event)"
                [maxSize]="5"
                [(page)]="page.pageNumber"
                [pageSize]="24"
                [collectionSize]="page.totalElements"
            ></ngb-pagination>
        </div>
    </div>

    <!-- /.cus-modal-wrap -->
    <div class="block allModal">
        <div class="cus-modal right-bottom" id="right-bottom" role="dialog">
            <div class="cus-modal-dialog">
                <div class="cus-modal-content">
                    <div class="cus-modal-body" style="font-size: 10px">
                        <a class="cus-close" (click)="close()">Ã—</a>
                        <h5 class="modal-title">Upload Arquivos</h5>
                        <br />
                        <div
                            *ngFor="
                                let progressInfo of progressInfos;
                                let i = index
                            "
                            class="mb-2"
                        >
                            <span>{{ progressInfo.fileName }}</span>
                            <div *ngIf="!progressInfo.error" class="progress">
                                <div
                                    [class]="progressInfo.class"
                                    role="progressbar"
                                    attr.aria-valuenow="{{
                                        progressInfo.value
                                    }}"
                                    aria-valuemin="0"
                                    aria-valuemax="100"
                                    [ngStyle]="{
                                        width: progressInfo.value + '%'
                                    }"
                                >
                                    {{ progressInfo.value }}%
                                </div>
                            </div>
                            <div
                                *ngIf="progressInfo.error"
                                style="display: flex; align-items: center"
                            >
                                <div class="progress" style="width: 88%">
                                    <div
                                        [class]="progressInfo.class"
                                        role="progressbar"
                                        attr.aria-valuenow="{{
                                            progressInfo.value
                                        }}"
                                        aria-valuemin="0"
                                        aria-valuemax="100"
                                        [ngStyle]="{
                                            width: progressInfo.value + '%'
                                        }"
                                    >
                                        {{ progressInfo.value }}%
                                    </div>
                                </div>
                                <button
                                    type="button"
                                    class="btn-xs btn-default"
                                    style="margin-left: 5px"
                                    (click)="reUpload(progressInfo, i)"
                                >
                                    <i class="fa fa-refresh"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
